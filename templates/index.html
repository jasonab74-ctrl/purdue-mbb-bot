<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Purdue MBB — All Sources</title>

  <!-- keep your existing site css if you have it -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

  <!-- minimal additive styles -->
  <style>
    .chips{display:flex;flex-wrap:wrap;gap:12px;margin:16px 0}
    .chip{display:inline-block;padding:10px 16px;background:#e7d7a5;color:#1f2937;border-radius:999px;text-decoration:none;font-weight:600;box-shadow:inset 0 -1px 0 rgba(0,0,0,.05)}
    .feed{display:grid;gap:12px}
    .card{display:grid;grid-template-columns:128px 1fr;gap:12px;align-items:start;padding:12px;border-radius:12px;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.06)}
    .thumb{width:128px;height:96px;border-radius:10px;object-fit:cover;background:#f3f4f6;display:block}
    @media (max-width:520px){.card{grid-template-columns:100px 1fr}.thumb{width:100px;height:78px}}
    .meta{display:flex;gap:8px;align-items:center;font-size:12px;color:#6b7280}
    .badge{background:#f1f5f9;color:#334155;border-radius:999px;padding:2px 8px;font-weight:600}
    .title{font-weight:700;line-height:1.2;text-decoration:none;color:#111827}
    .title:hover{text-decoration:underline}
    .snippet{margin:0;color:#374151;font-size:14px}
    .empty{color:#6b7280;padding:24px 0;text-align:center}
    .header{display:flex;justify-content:space-between;align-items:center;padding:16px 16px 0 16px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand h1{margin:0;font-size:20px}
    .footer{padding:24px 16px;color:#6b7280;text-align:center}
  </style>
</head>
<body>
  <header class="header">
    <div class="brand">
      <span style="font-size:20px">⬢</span>
      <h1>Purdue Men’s Basketball Hub</h1>
    </div>
    <audio controls preload="none" style="width:200px;max-width:60vw">
      <source src="{{ url_for('static', filename='fight_song.mp3') }}" type="audio/mpeg">
    </audio>
  </header>

  <main class="container" style="padding:16px">
    <section class="chips">
      <a class="chip" href="https://www.espn.com/mens-college-basketball/team/_/id/2509/purdue-boilermakers" target="_blank" rel="noopener">ESPN – Purdue MBB</a>
      <a class="chip" href="https://www.cbssports.com/college-basketball/teams/PUR/purdue-boilermakers/" target="_blank" rel="noopener">CBS – Purdue MBB</a>
      <a class="chip" href="https://www.hammerandrails.com/" target="_blank" rel="noopener">Hammer & Rails</a>
      <a class="chip" href="https://goldandblack.com/" target="_blank" rel="noopener">GoldandBlack</a>
      <a class="chip" href="https://www.barstoolsports.com/tag/purdue" target="_blank" rel="noopener">Barstool – Purdue</a>
      <a class="chip" href="https://purduesports.com/sports/mens-basketball/schedule" target="_blank" rel="noopener">Purdue – Schedule</a>
      <a class="chip" href="https://purduesports.com/sports/mens-basketball/roster" target="_blank" rel="noopener">Purdue – Roster</a>
      <a class="chip" href="https://www.reddit.com/r/Boilermakers/" target="_blank" rel="noopener">Reddit – r/Boilermakers</a>
      <a class="chip" href="https://www.youtube.com/@TheFieldOf68" target="_blank" rel="noopener">YouTube – Field of 68</a>
      <a class="chip" href="https://www.youtube.com/@SleepersMedia" target="_blank" rel="noopener">YouTube – Sleepers Media</a>
    </section>

    <!-- server-provided list (any of these vars) -->
    {% set feed_list = items or posts or entries or results or cards %}
    <section id="feed" class="feed">
      {% if feed_list and feed_list|length > 0 %}
        {% for item in feed_list %}
          <article class="card">
            <img class="thumb" alt="" loading="lazy"
                 src="{{ item.get('image') or item.get('image_url') or item.get('media_image') or item.get('thumbnail') or '' }}">
            <div style="display:grid;gap:6px">
              <div class="meta">
                {% if item.get('source') %}<span class="badge">{{ item['source'] }}</span>{% endif %}
                {% if item.get('published') or item.get('date') %}<time>{{ (item.get('published') or item.get('date'))[:10] }}</time>{% endif %}
              </div>
              <a class="title" href="{{ item['link'] }}" target="_blank" rel="noopener">{{ item['title'] }}</a>
              {% if item.get('summary') %}<p class="snippet">{{ item['summary'] }}</p>{% endif %}
            </div>
          </article>
        {% endfor %}
      {% endif %}
    </section>

    {% if not (feed_list and feed_list|length > 0) %}
      <p id="empty" class="empty">No items yet. Check back soon.</p>
    {% endif %}
  </main>

  <footer class="footer">
    <small>Unofficial fan aggregation. Purdue © their owners.</small>
  </footer>

  <!-- Client fallback + thumbnails -->
  <script>
    // inline basketball SVG fallback
    const FALLBACK =
      'data:image/svg+xml;utf8,' + encodeURIComponent(
        `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128">
           <defs><linearGradient id="g" x1="0" x2="0" y1="0" y2="1">
             <stop offset="0" stop-color="#f8b26a"/><stop offset="1" stop-color="#f4a261"/></linearGradient></defs>
           <circle cx="64" cy="64" r="60" fill="url(#g)"/>
           <path d="M8 64h112M64 8v112M25 25c52 52 78 52 78 78M103 25c-52 52-78 52-78 78"
                 stroke="#1f2937" stroke-width="6" fill="none" stroke-linecap="round"/></svg>`);

    function ytThumb(url){
      try{
        const u=new URL(url); const h=u.hostname.toLowerCase();
        if(h.includes('youtube.com')){const v=new URLSearchParams(u.search).get('v'); return v?`https://i.ytimg.com/vi/${v}/hqdefault.jpg`:null;}
        if(h.includes('youtu.be')){const v=u.pathname.replace(/^\//,''); return v?`https://i.ytimg.com/vi/${v}/hqdefault.jpg`:null;}
      }catch(e){}
      return null;
    }

    function normalize(raw){
      if (!raw) return [];
      if (Array.isArray(raw)) return raw;
      if (raw.items && Array.isArray(raw.items)) return raw.items;
      if (raw.results && Array.isArray(raw.results)) return raw.results;
      return [];
    }

    function render(list){
      const feed = document.getElementById('feed');
      const empty = document.getElementById('empty');
      if (empty) empty.remove();
      feed.innerHTML = '';
      list.forEach(item=>{
        const link = item.link || '';
        let img = item.image || item.image_url || item.media_image || item.thumbnail || '';
        const yti = ytThumb(link);
        if (yti) img = yti;
        if (!img) img = FALLBACK;

        const art = document.createElement('article'); art.className='card';
        const im = document.createElement('img'); im.className='thumb'; im.loading='lazy'; im.alt=''; im.src=img;
        const body = document.createElement('div'); body.style.display='grid'; body.style.gap='6px';

        const meta = document.createElement('div'); meta.className='meta';
        if (item.source){ const b=document.createElement('span'); b.className='badge'; b.textContent=item.source; meta.appendChild(b); }
        const dt = (item.published || item.date || '').slice(0,10);
        if (dt){ const t=document.createElement('time'); t.textContent=dt; meta.appendChild(t); }

        const a = document.createElement('a'); a.className='title'; a.href=link; a.target='_blank'; a.rel='noopener'; a.textContent=item.title || link;
        const snip = document.createElement('p'); snip.className='snippet'; snip.textContent=item.summary || '';

        body.appendChild(meta); body.appendChild(a); if (snip.textContent) body.appendChild(snip);
        art.appendChild(im); art.appendChild(body); feed.appendChild(art);
      });
    }

    async function tryFetch(url){
      try{
        const r = await fetch(url, {cache:'no-store'});
        if (!r.ok) return null;
        return await r.json();
      }catch(e){ return null; }
    }

    async function boot(){
      const serverHadItems = document.querySelectorAll('#feed .card').length > 0;
      if (serverHadItems){
        // add thumbnails to server-rendered items if they were blank
        document.querySelectorAll('#feed .card').forEach(card=>{
          const a = card.querySelector('a.title');
          const img = card.querySelector('img.thumb');
          const link = a ? a.href : '';
          const provided = img ? img.getAttribute('src') : '';
          if (provided) return;
          const yti = ytThumb(link);
          img.src = yti || FALLBACK;
        });
        return;
      }
      // server passed nothing: fetch what collectors wrote
      const candidates = ['/items.json','/data/items.json','/static/items.json'];
      for (const c of candidates){
        const raw = await tryFetch(c);
        const list = normalize(raw);
        if (list.length){ render(list); return; }
      }
      // nothing found; leave the "No items yet" message
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', boot);
    } else {
      boot();
    }
  </script>
</body>
</html>
