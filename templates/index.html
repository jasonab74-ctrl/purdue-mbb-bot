<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Purdue Men’s Basketball — Live Feed</title>

  <!-- CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
  <link rel="mask-icon" href="{{ url_for('static', filename='safari-pinned-tab.svg') }}" color="#C5A559">

  <!-- iOS Home Screen / Safari Favorites -->
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
  <meta name="apple-mobile-web-app-title" content="Purdue MBB Feed">

  <!-- Theme -->
  <meta name="theme-color" content="#C5A559">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="brand">
        <img src="{{ url_for('static', filename='logo.png') }}" class="logo" alt="Purdue Logo">
        <div>
          <h1>Purdue Men’s Basketball</h1>
          <div class="sub">
            {{ items|length }} articles · Updated: {{ updated }}
          </div>
        </div>
      </div>
      <button class="fight-btn" onclick="playFightSong()">▶ Fight Song</button>
    </div>

    <!-- Quick Links -->
    <div class="quick">
      {% for link in static_links %}
        <a class="pill" href="{{ link.url }}" target="_blank">{{ link.label }}</a>
      {% endfor %}
    </div>

    <!-- Controls -->
    <div class="controls">
      <input id="searchInput" class="input" type="text" placeholder="Search articles..." onkeyup="filterArticles()">
      <select id="sourceFilter" class="select" onchange="filterArticles()">
        <option value="">All Sources</option>
        {% for feed in feeds %}
          <option value="{{ feed.name }}">{{ feed.name }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Notice (new items) -->
    <div id="notice" class="notice hidden">New items available — refresh to load.</div>

    <!-- Articles -->
    <ul id="items" class="items">
      {% for item in items %}
      <li class="item" data-source="{{ item.source }}">
        <div class="item-head">
          <a class="title" href="{{ item.link }}" target="_blank">{{ item.title }}</a>
          <span class="badge">{{ item.source }}</span>
        </div>
        <div class="meta">{{ item.published }}</div>
        {% if item.summary %}
          <div class="desc">{{ item.summary }}</div>
        {% endif %}
      </li>
      {% endfor %}
    </ul>

    <!-- Footer -->
    <div class="footer">
      &copy; {{ now.year }} Purdue MBB Feed · Unofficial Fan Project
    </div>
  </div>

  <!-- Script -->
  <script>
    function playFightSong() {
      const audio = new Audio("{{ url_for('static', filename='fight.mp3') }}");
      audio.play();
    }

    function filterArticles() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const filter = document.getElementById('sourceFilter').value;
      const items = document.querySelectorAll('#items .item');
      items.forEach(item => {
        const title = item.querySelector('.title').textContent.toLowerCase();
        const source = item.dataset.source;
        const matchesText = title.includes(search);
        const matchesSource = !filter || source === filter;
        item.style.display = (matchesText && matchesSource) ? '' : 'none';
      });
    }

    async function checkForUpdates() {
      try {
        const resp = await fetch('/items.json?_ts=' + Date.now());
        const data = await resp.json();
        if (data.items.length > {{ items|length }}) {
          document.getElementById('notice').classList.remove('hidden');
        }
      } catch (err) {
        console.error(err);
      }
    }
    setInterval(checkForUpdates, 300000); // 5 min
  </script>
</body>
</html>
