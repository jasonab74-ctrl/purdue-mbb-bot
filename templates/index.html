<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Purdue Men’s Basketball — Feed</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header>
    <div class="row">
      <h1 style="margin:0">Purdue Men’s Basketball — Live Feed</h1>
      <span class="muted">({{ items|length }} dynamic items)</span>
    </div>

    <!-- Always-present static sources -->
    <nav class="quick" aria-label="Quick links">
      {% for q in quick_links %}
        <a href="{{ q.url }}" target="_blank" rel="noopener" data-static="{{ q.id }}">{{ q.label }}</a>
      {% endfor %}
    </nav>
  </header>

  <section class="controls">
    <label for="sourceFilter">Filter by source:</label>
    <select id="sourceFilter">
      <option value="__all__">All dynamic sources</option>
      {% for s in sources %}
        <option value="{{ s }}">{{ s }}</option>
      {% endfor %}
    </select>
    <span class="muted" id="countNote"></span>
  </section>

  <main>
    {% if items and items|length %}
      <ul class="items" id="itemsList">
        {% for it in items %}
          <li class="item" data-source="{{ it.source|e }}">
            <h3>
              {% if it.link %}
                <a href="{{ it.link }}" target="_blank" rel="noopener">{{ it.title }}</a>
              {% else %}
                {{ it.title }}
              {% endif %}
            </h3>
            <div class="muted">
              {% if it.source %}<strong>{{ it.source }}</strong>{% endif %}
              {% if it.date %} · {{ it.date }}{% endif %}
            </div>
            {% if it.description %}<p>{{ it.description }}</p>{% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="empty">No dynamic items yet. Quick links above are always available.</div>
    {% endif %}
  </main>

  <script>
    (function () {
      const sel = document.getElementById('sourceFilter');
      const list = document.getElementById('itemsList');
      const note = document.getElementById('countNote');

      function applyFilter() {
        if (!list) return;
        const val = sel.value;
        let shown = 0;
        for (const li of list.querySelectorAll('.item')) {
          const src = li.getAttribute('data-source') || '';
          const match = (val === '__all__') || (src === val);
          li.style.display = match ? '' : 'none';
          if (match) shown++;
        }
        note.textContent = list ? `${shown} shown` : '';
      }

      if (sel) {
        sel.addEventListener('change', applyFilter);
        applyFilter();
      }
    })();
  </script>
</body>
</html>
