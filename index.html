<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Purdue Boilermakers — Men’s Basketball</title>
  <link rel="preload" as="audio" href="static/hail-purdue.mp3" />
  <link rel="icon" href="static/logo.png">
  <link rel="stylesheet" href="style.css?v=2" />
</head>
<body>
  <header class="site-header">
    <img class="team-logo" src="static/logo.png" alt="Purdue logo" width="48" height="48" />
    <div class="title-wrap">
      <h1 class="title">Purdue Boilermakers — Men’s Basketball</h1>
      <p class="subtitle">Live team feed · auto-updates</p>
    </div>
    <button id="fightBtn" class="pill primary" type="button" aria-label="Play Hail Purdue">
      <span class="playdot">►</span> Hail Purdue
    </button>
    <audio id="song" preload="auto">
      <source src="static/hail-purdue.mp3" type="audio/mpeg" />
    </audio>
  </header>

  <nav class="links">
    <a class="pill" href="https://purduesports.com/sports/mens-basketball/schedule" target="_blank" rel="noopener">Schedule</a>
    <a class="pill" href="https://purduesports.com/sports/mens-basketball/roster" target="_blank" rel="noopener">Roster</a>
    <a class="pill" href="https://purduesports.com/sports/mens-basketball/tickets" target="_blank" rel="noopener">Tickets</a>
    <a class="pill" href="https://www.reddit.com/r/Boilermakers/" target="_blank" rel="noopener">Reddit — r/Boilermakers</a>
    <a class="pill" href="https://www.espn.com/mens-college-basketball/team/_/id/2509/purdue-boilermakers" target="_blank" rel="noopener">ESPN Team</a>
    <a class="pill" href="https://kenpom.com/" target="_blank" rel="noopener">KenPom</a>
    <a class="pill" href="https://www.sports-reference.com/cbb/schools/purdue/" target="_blank" rel="noopener">Sports-Reference</a>
    <a class="pill" href="https://bigten.org/standings.aspx?path=mbball" target="_blank" rel="noopener">Big Ten Standings</a>
    <a class="pill" href="https://www.espn.com/mens-college-basketball/rankings" target="_blank" rel="noopener">AP Top 25</a>
    <a class="pill" href="https://www.espn.com/mens-college-basketball/bracketology" target="_blank" rel="noopener">Bracketology</a>
    <a class="pill" href="https://www.youtube.com/results?search_query=Purdue+basketball+highlights" target="_blank" rel="noopener">Highlights</a>
    <a class="pill" href="https://247sports.com/college/purdue/" target="_blank" rel="noopener">247Sports</a>
    <a class="pill" href="https://purdue.rivals.com/" target="_blank" rel="noopener">Rivals</a>
    <a class="pill" href="https://www.cbssports.com/college-basketball/teams/PUR/purdue-boilermakers/" target="_blank" rel="noopener">CBS Purdue</a>
  </nav>

  <section class="controls">
    <label for="srcSel" class="label">Source:</label>
    <select id="srcSel" class="select">
      <!-- Hardened, known-good sources -->
      <option value="__all__" selected>All sources</option>
      <option>Hammer and Rails</option>
      <option>Google News</option>
      <option>PurdueSports.com</option>
      <option>Journal &amp; Courier</option>
      <option>GoldandBlack.com</option>
      <option>The Athletic</option>
      <option>ESPN</option>
      <option>Sports Illustrated</option>
      <option>CBS Sports</option>
      <option>Big Ten Network</option>
      <option>Yahoo Sports</option>
    </select>

    <div class="updated">
      <span class="label">Updated:</span>
      <time id="updatedTs">—</time>
    </div>
  </section>

  <main id="feed" class="feed"></main>

  <template id="cardTmpl">
    <article class="card">
      <a class="title-link" target="_blank" rel="noopener"></a>
      <div class="meta">
        <span class="source"></span>
        <span class="dot">•</span>
        <time class="when"></time>
      </div>
    </article>
  </template>

  <script>
    // ------- FIGHT SONG -------
    const fightBtn = document.getElementById('fightBtn');
    const song = document.getElementById('song');
    let playing = false;
    fightBtn.addEventListener('click', () => {
      if (!playing) { song.currentTime = 0; song.play(); fightBtn.classList.add('paused'); }
      else { song.pause(); fightBtn.classList.remove('paused'); }
      playing = !playing;
    });
    song.addEventListener('ended', () => { playing = false; fightBtn.classList.remove('paused'); });

    // ------- FEED -------
    const feedEl = document.getElementById('feed');
    const updatedEl = document.getElementById('updatedTs');
    const srcSel = document.getElementById('srcSel');

    // Small helper: en-US date/time
    const fmt = new Intl.DateTimeFormat('en-US', {
      month: 'short', day: 'numeric', year: 'numeric',
      hour: 'numeric', minute: '2-digit'
    });

    // Very light sport filter to avoid stray football posts
    const BBALL_HINTS = [
      'mbb','basketball','boilermakers', 'big ten', 'bracket', 'kenpom',
      'matt painter','mackey','boiler','guard','forward','center','ncaa'
    ];

    function seemsBasketball(title) {
      const t = (title || '').toLowerCase();
      // reject obvious football hints
      if (/(football|qb|touchdown|wide receiver|running back|nfl|helmet)/.test(t)) return false;
      // allow if any bball hint is present, else neutral (true)
      return BBALL_HINTS.some(k => t.includes(k)) || true;
    }

    async function load() {
      try {
        const res = await fetch('items.json', {cache:'no-store'});
        const data = await res.json();
        const items = (data.items || data || []).filter(x => x && x.title && seemsBasketball(x.title));

        render(items);
        const t = data.updated || new Date().toISOString();
        updatedEl.textContent = fmt.format(new Date(t));
      } catch (e) {
        console.error(e);
        updatedEl.textContent = '—';
        feedEl.innerHTML = '<p class="empty">No items found.</p>';
      }
    }

    function render(items) {
      const selected = srcSel.value;
      feedEl.innerHTML = '';
      const tmpl = document.getElementById('cardTmpl');

      items
      .filter(it => selected === '__all__' || (it.source||'').toLowerCase().includes(selected.toLowerCase()))
      .forEach(it => {
        const node = tmpl.content.cloneNode(true);
        const link = node.querySelector('.title-link');
        link.textContent = it.title;
        link.href = it.link;

        node.querySelector('.source').textContent = (it.source || '').trim() || '—';
        try {
          node.querySelector('.when').textContent = fmt.format(new Date(it.date || it.pubDate || it.published || it.updated || Date.now()));
        } catch {
          node.querySelector('.when').textContent = '—';
        }
        feedEl.appendChild(node);
      });

      if (!feedEl.children.length) {
        feedEl.innerHTML = '<p class="empty">Nothing to show from this source yet.</p>';
      }
    }

    srcSel.addEventListener('change', () => load());
    document.addEventListener('visibilitychange', () => { if (!document.hidden) load(); });
    load();
  </script>
</body>
</html>