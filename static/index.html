<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Purdue Men's Basketball News</title>
  <style>
    :root{--gold:#c79a26;--ink:#1a1a1a;--muted:#6c6c6c;--bg:#f6f7f8;--card:#fff;--ring:#d9dbe0}
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:inherit;text-decoration:none}
    header{position:sticky;top:0;background:#fff;border-bottom:3px solid var(--gold);display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;z-index:10}
    .logo{height:26px;width:auto}
    h1{margin:0;font-size:1.35rem;color:var(--gold);font-weight:800;letter-spacing:.2px}
    .actions{margin-left:auto;display:flex;gap:.5rem;align-items:center}
    .search{padding:.5rem .7rem;border:1px solid var(--ring);border-radius:10px;min-width:220px}
    .btn{padding:.5rem .9rem;border:2px solid #1e40af;border-radius:10px;background:#fff;font-weight:700;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .subline{display:flex;gap:1rem;justify-content:center;color:var(--muted);font-size:.9rem;padding:.5rem 1rem}
    main{max-width:980px;margin:0 auto;padding:1rem}
    .articles{display:grid;grid-template-columns:1fr;gap:.9rem}
    @media(min-width:780px){.articles{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border:1px solid #eee;border-radius:14px;padding:1rem;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .card h2{margin:.1rem 0 .5rem 0;font-size:1.05rem}
    .card p{margin:0 0 .6rem 0;line-height:1.35}
    .meta{display:flex;justify-content:space-between;color:var(--muted);font-size:.8rem}
    .center{text-align:center;margin:2rem 0}
    .error{color:#a30000}
  </style>
</head>
<body>
  <header>
    <img src="/static/purdue.png" alt="Purdue" class="logo"/>
    <h1>Purdue Men's Basketball News</h1>
    <div class="actions">
      <input id="q" class="search" type="search" placeholder="Search articles‚Ä¶"/>
      <button id="refreshBtn" class="btn">Refresh</button>
    </div>
  </header>

  <div class="subline">
    <span id="status">Booting‚Ä¶</span>
    <span>üèÅ Boiler Up ‚Äî auto-updates every 5 min</span>
  </div>

  <main>
    <section id="articles" class="articles"></section>
  </main>

  <script>
    const $ = (s)=>document.querySelector(s);
    function esc(s){const d=document.createElement("div");d.innerText=s||"";return d.innerHTML;}
    function render(list){
      const box=$("#articles");
      if(!list||list.length===0){ box.innerHTML=`<p class="center">No articles found.</p>`; return; }
      box.innerHTML="";
      for(const a of list){
        const el=document.createElement("article");
        el.className="card";
        el.innerHTML=`
          <h2><a href="${a.link}" target="_blank" rel="noopener">${esc(a.title)}</a></h2>
          <p>${esc(a.summary||"")}</p>
          <div class="meta"><span>${esc(a.source||"")}</span><span>${a.published?new Date(a.published).toLocaleString():""}</span></div>
        `;
        box.appendChild(el);
      }
    }
    async function getJSON(url){const r=await fetch(url,{cache:"no-store"}); if(!r.ok) throw new Error("HTTP "+r.status); return await r.json();}
    async function load(q=""){
      $("#status").textContent = q?`Searching ‚Äú${q}‚Äù‚Ä¶`:"Loading‚Ä¶";
      try{
        if(!window.__refreshedOnce){ window.__refreshedOnce=true; try{ await getJSON("/api/refresh-now"); }catch{} }
        const endpoint=q?`/api/search?q=${encodeURIComponent(q)}`:"/api/articles";
        const data=await getJSON(endpoint);
        render(data.articles||[]);
        try{
          const h=await getJSON("/api/health");
          $("#status").textContent=`Loaded ${data.articles?.length||0} ‚Ä¢ Last refresh ${h.last_refresh?new Date(h.last_refresh).toLocaleTimeString():"‚Äì"}`;
        }catch{ $("#status").textContent=`Loaded ${data.articles?.length||0}`; }
      }catch(e){
        console.error(e);
        $("#articles").innerHTML=`<p class="center error">Failed to load. Try Refresh.</p>`;
        $("#status").textContent="Error";
      }
    }
    $("#refreshBtn").addEventListener("click",()=>load($("#q").value.trim()));
    $("#q").addEventListener("input",()=>{clearTimeout(window.__deb); window.__deb=setTimeout(()=>load($("#q").value.trim()),250);});
    load();
  </script>
</body>
</html>
